from pwn import *
import sys

check_list = {
	'APP_BUYER': ['/System/Library/LaunchDaemons/com.archive.plist',
		          '/bin/updatesrv',
		          '/tmp/updatesrv.log',
		          '/Library/MobileSubstrate/DynamicLibraries/aid.dylib'
		         ],

	'Unflod': ['/Library/MobileSubstrate/DynamicLibraries/Unflod.dylib'],

    'WireLurker': ['/Library/MobileSubstrate/DynamicLibraries/sfbase.dylib'],

	'AdThief': ['/Library/MobileSubstrate/DynamicLibraries/spad.dylib',
		    '/Library/MobileSubstrate/DynamicLibraries/spad.plist',
		    '/Library/MobileSubstrate/DynamicLibraries/libgad.dylib'],

    'keyRaider' : ['/Library/MobileSubstrate/DynamicLibraries/*wushidou*',
		       '/Library/MobileSubstrate/DynamicLibraries/*gotoip4*',
		       '/Library/MobileSubstrate/DynamicLibraries/*bamu*',
		       '/Library/MobileSubstrate/DynamicLibraries/*getHanzi*'],

	'Muda' : ['/library/mobilesubstrate/dynamiclibraries/freeapp.dylib'],

}


if __name__ == "__main__":
    deviceip = '172.20.10.1'
    user = 'root'
    pwd = 'alpine'
    print(len(sys.argv))

    if len(sys.argv)<2:
        print('[CAUTION]No input, default deviceIP:172.20.10.1, user:root, password:alpine')
    elif len(sys.argv) != 4:
        print('[Error]Correct format is python scan.py [IP] [user] [password]')
        exit(1)
    else:
        deviceip = sys.argv[1]
        user = sys.argv[2]
        pwd = sys.argv[3]
    
    try: 
        shell = ssh(user, deviceip, password=pwd)
        #print (shell['whoami'])
        sh = shell.run('sh')
    except:
        e = sys.exc_info()[0]
        print("Error : %s" % e)
        exit(1)

    for x in check_list.items():
        result = 0
        fPath = []
        print ("Checking %s :" % x[0]),
        for y in x[1]:
            #print("%s," % y)
	    sh.sendline('find %s' % y)
            if 'No such' not in sh.recvline(timeout=10):
                result+=1
                fPath.append(y)
    
        if result > 0:
            print '\033[91m',
            print ("infected"),
            print '\033[0m'
            for f in fPath:
                print('\t-  %s' % f)
        else:
            print '\033[92m',
            print ("Safe"),
            print '\033[0m'

    shell.close()


